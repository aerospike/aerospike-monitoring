name: Create tar.gz artifacts of dashboards

on: 
  push:
    tags:
       - v*

permissions:
  id-token: write
  actions: write
  contents: write

jobs:         
    tar_zipping_job:
      runs-on: ubuntu-latest    
      steps:
        - name: Harden the runner (Audit all outbound calls)
          uses: step-security/harden-runner@df199fb7be9f65074067a9eb93f12bb4c5547cf2 # v2.13.3
          with:
            egress-policy: audit

        - uses: actions/checkout@93cb6efe18208431cddfb8368fd83d5badbf9bfd # v5.0.1

        - uses: actions-ecosystem/action-get-latest-tag@b7c32daec3395a9616f88548363a42652b22d435 # v1.6.0
          id: get-latest-tag

        - name: Create tar files
          env:
            GH_TOKEN: ${{ github.token }}
            TAG_NAME: "${{ steps.get-latest-tag.outputs.tag }}"
          run: |
            cd config/grafana
            echo "Tar-zipping files"
            tar czf aerospike-grafana-dashboards-$TAG_NAME.tar.gz dashboards/*
            echo
            echo "Uploading release asset"
            gh release upload "$TAG_NAME" "aerospike-grafana-dashboards-$TAG_NAME.tar.gz"
